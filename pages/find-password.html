<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>완대전</title>
    <meta
      name="description"
      content="완도고등학교 학생들을 위한 웹 커뮤니티 사이트입니다."
    />

    <!-- Open Graph 태그 (소셜 미디어 공유용) -->
    <meta property="og:title" content="완대전" />
    <meta
      property="og:description"
      content="완도고등학교 학생들을 위한 웹 커뮤니티 사이트입니다."
    />
    <meta property="og:image" content="https://wdj.kr/content.png" />
    <meta property="og:url" content="https://wdj.kr/" />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/asset/icon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/asset/icon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/asset/icon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/asset/icon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/asset/icon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/asset/icon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/asset/icon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/asset/icon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/asset/icon/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/asset/icon/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/asset/icon/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/asset/icon/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/asset/icon/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/asset/icon/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/asset/icon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="/asset/icon/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/asset/icon/favicon-16x16.png"
    />
    <link rel="manifest" href="/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png" />
    <meta name="theme-color" content="#ffffff" />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Pretendard", "sans-serif"],
            },
            colors: {
              primary: {
                50: "#E6F0FF",
                100: "#CCE0FF",
                200: "#99C2FF",
                300: "#66A3FF",
                400: "#3385FF",
                500: "#0066FF",
                600: "#0052CC",
                700: "#003D99",
                800: "#002966",
                900: "#001433",
              },
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      #mobile-menu {
        transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        max-height: 0;
        opacity: 0;
        overflow: hidden;
      }
      #mobile-menu.active {
        max-height: 400px;
        opacity: 1;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <header class="bg-blue-600 shadow-md py-1 mb-8">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div
          class="flex justify-between items-center py-4 md:justify-start md:space-x-10"
        >
          <div class="flex justify-start lg:w-0 lg:flex-1">
            <a
              href="/index.html"
              class="text-3xl font-bold text-white hover:text-gray-200 transition duration-300"
            >
              완·대·전
            </a>
          </div>
          <nav class="hidden md:flex space-x-10">
            <a
              href="notice.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >공지사항</a
            >
            <a
              href="community.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >커뮤니티</a
            >
            <a
              href="petition.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >청원·제안</a
            >
            <a
              href="utility.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >학급 도우미</a
            >
            <a
              href="about.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >소개</a
            >
          </nav>
        </div>
      </div>
    </header>

    <main class="container mx-auto mt-8 px-4 mb-20">
      <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-8">
        <div class="mb-8">
          <h3 class="text-2xl font-bold mb-4 text-center text-gray-700">
            비밀번호를 잊으셨나요?
          </h3>
          <div class="text-center space-y-6">
            <div class="bg-blue-50 p-6 rounded-lg">
              <i class="fas fa-info-circle text-blue-500 text-3xl mb-4"></i>
              <p class="text-gray-600 text-lg mb-3">
                학교 계정의 비밀번호를 잊어버리셨다면<br />
                아래의 방법으로 도움을 받으실 수 있습니다
              </p>
              <div class="space-y-4 text-left mt-6">
                <div class="flex items-start space-x-3">
                  <div class="flex-shrink-0">
                    <i class="fas fa-envelope text-blue-500"></i>
                  </div>
                  <div>
                    <p class="text-gray-700 font-medium">이메일로 문의하기</p>
                    <p class="text-gray-500 text-sm">
                      관리자 이메일(sungblab@gmail.com)로<br />
                      학번과 실명을 포함하여 문의해 주세요
                    </p>
                  </div>
                </div>
                <div class="flex items-start space-x-3">
                  <div class="flex-shrink-0">
                    <i class="fas fa-clock text-blue-500"></i>
                  </div>
                  <div>
                    <p class="text-gray-700 font-medium">처리 소요 시간</p>
                    <p class="text-gray-500 text-sm">
                      문의 접수 후 24시간 이내에<br />
                      임시 비밀번호를 발급해 드립니다
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="flex flex-col items-center space-y-4">
              <a
                href="mailto:sungblab@gmail.com?subject=비밀번호 재설정 요청&body=학번: %0A실명: %0A요청사유: "
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 inline-flex items-center space-x-2"
              >
                <i class="fas fa-envelope"></i>
                <span>관리자에게 이메일 보내기</span>
              </a>
              <p class="text-sm text-gray-500">
                * 보안을 위해 임시 비밀번호 발급 후 반드시 비밀번호를 변경해
                주세요
              </p>
            </div>
          </div>
        </div>

        <div class="border-t border-gray-200 my-8"></div>

        <div id="passwordChangeSection" style="display: none">
          <h3 class="text-2xl font-bold mb-6 text-center text-gray-700">
            비밀번호 변경
          </h3>
          <form id="passwordChangeForm">
            <div class="mb-4">
              <label
                class="block text-gray-700 font-bold mb-2"
                for="currentPassword"
              >
                현재 비밀번호
              </label>
              <input
                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                id="currentPassword"
                type="password"
                placeholder="현재 비밀번호를 입력하세요"
                required
              />
            </div>
            <div class="mb-4">
              <label
                class="block text-gray-700 font-bold mb-2"
                for="newPassword"
              >
                새 비밀번호
              </label>
              <input
                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                id="newPassword"
                type="password"
                placeholder="새 비밀번호를 입력하세요"
                required
              />
            </div>
            <div class="mb-6">
              <label
                class="block text-gray-700 font-bold mb-2"
                for="confirmPassword"
              >
                새 비밀번호 확인
              </label>
              <input
                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                id="confirmPassword"
                type="password"
                placeholder="새 비밀번호를 다시 입력하세요"
                required
              />
            </div>
            <button
              type="submit"
              class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300"
            >
              비밀번호 변경
            </button>
          </form>
          <div id="message" class="mt-4 text-center text-sm"></div>
        </div>

        <div
          id="loginMessage"
          class="text-center mt-4 text-red-500"
          style="display: none"
        >
          비밀번호를 변경하려면 로그인이 필요합니다.
        </div>

        <div class="text-center mt-8">
          <a
            href="/index.html"
            class="text-blue-500 hover:text-blue-700 transition duration-300"
          >
            메인페이지로 돌아가기
          </a>
        </div>
      </div>
    </main>

    <footer
      class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-6 md:py-10"
    >
      <div class="container mx-auto px-6 lg:px-8">
        <!-- 모바일용 푸터 -->
        <div class="md:hidden space-y-3">
          <div class="flex justify-center space-x-4">
            <a
              href="pages/notice.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >공지사항</a
            >
            <a
              href="pages/community.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >커뮤니티</a
            >
            <a
              href="pages/petition.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >청원·제안</a
            >
          </div>

          <div class="text-center text-sm text-gray-400">
            <a href="mailto:sungblab@gmail.com" class="hover:text-blue-400">
              sungblab@gmail.com
            </a>
          </div>
        </div>

        <!-- 데스크톱용 푸터 -->
        <div class="hidden md:grid grid-cols-3 gap-8">
          <!-- 기존 데스크톱 푸터 내용 유지 -->
          <div class="space-y-3">
            <h3 class="text-xl font-bold text-white mb-2">완·대·전</h3>
            <p class="text-gray-400 text-sm leading-relaxed">
              완도고등학교 학생들을 위한<br />
              더 나은 학교생활을 만들어가는<br />
              온라인 커뮤니티 플랫폼
            </p>
          </div>

          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-white mb-2">바로가기</h4>
            <ul class="space-y-1.5">
              <li>
                <a
                  href="pages/notice.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >공지사항</a
                >
              </li>
              <li>
                <a
                  href="pages/community.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >커뮤니티</a
                >
              </li>
              <li>
                <a
                  href="pages/petition.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >청원·제안</a
                >
              </li>
              <li>
                <a
                  href="pages/utility.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >학급 도우미</a
                >
              </li>
            </ul>
          </div>

          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-white mb-2">문의 및 정책</h4>
            <div class="space-y-1.5">
              <p class="flex items-center text-gray-400 text-sm">
                <i class="fas fa-envelope mr-2"></i>
                <a
                  href="mailto:sungblab@gmail.com"
                  class="hover:text-blue-400 transition-colors duration-300"
                  >sungblab@gmail.com</a
                >
              </p>
              <p class="flex items-center text-gray-400 text-sm">
                <i class="fas fa-map-marker-alt mr-2"></i>
                전남 완도군 완도읍 개포로 134
              </p>
              <a
                href="/pages/privacy-policy.html"
                class="block text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
              >
                <i class="fas fa-shield-alt mr-2"></i>
                개인정보 처리방침
              </a>
            </div>
          </div>
        </div>

        <!-- 공통 하단 영역 -->
        <div class="border-t border-gray-700 mt-8 pt-6">
          <div class="flex flex-col items-center space-y-3">
            <p class="text-xs text-gray-400 text-center">
              &copy; 2024 완도고등학교 학생회. All rights reserved.
            </p>
            <div class="flex space-x-4">
              <a
                href="#"
                class="text-gray-400 hover:text-blue-400 transition-colors duration-300"
              >
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      async function checkLoginStatus() {
        const token = localStorage.getItem("token");
        if (!token) {
          document.getElementById("passwordChangeSection").style.display =
            "none";
          document.getElementById("loginMessage").style.display = "block";
          return false;
        }

        try {
          const response = await fetch("https://116.123.74.248/api/user", {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            document.getElementById("passwordChangeSection").style.display =
              "block";
            document.getElementById("loginMessage").style.display = "none";
            return true;
          } else {
            throw new Error("Login session expired");
          }
        } catch (error) {
          console.error("Error:", error);
          localStorage.removeItem("token");
          document.getElementById("passwordChangeSection").style.display =
            "none";
          document.getElementById("loginMessage").style.display = "block";
          return false;
        }
      }

      document.addEventListener("DOMContentLoaded", checkLoginStatus);

      document
        .getElementById("passwordChangeForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const currentPassword =
            document.getElementById("currentPassword").value;
          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;
          const messageElement = document.getElementById("message");

          if (newPassword !== confirmPassword) {
            messageElement.textContent = "새 비밀번호가 일치하지 않습니다.";
            messageElement.className = "mt-4 text-center text-sm text-red-500";
            return;
          }

          try {
            const token = localStorage.getItem("token");
            if (!token) {
              messageElement.textContent = "로그인이 필요합니다.";
              messageElement.className =
                "mt-4 text-center text-sm text-red-500";
              return;
            }

            const response = await fetch(
              "https://116.123.74.248/api/change-password",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({ currentPassword, newPassword }),
              }
            );

            const data = await response.json();

            if (response.ok) {
              messageElement.textContent = data.message;
              messageElement.className =
                "mt-4 text-center text-sm text-green-500";
              document.getElementById("currentPassword").value = "";
              document.getElementById("newPassword").value = "";
              document.getElementById("confirmPassword").value = "";
            } else {
              messageElement.textContent =
                data.message || "비밀번호 변경에 실패했습니다.";
              messageElement.className =
                "mt-4 text-center text-sm text-red-500";
            }
          } catch (error) {
            console.error("Error:", error);
            messageElement.textContent =
              "서버 오류가 발생했습니다: " + error.message;
            messageElement.className = "mt-4 text-center text-sm text-red-500";
          }
        });
    </script>
  </body>
</html>
