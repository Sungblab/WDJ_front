<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì™„ëŒ€ì „</title>
    <meta
      name="description"
      content="ì™„ë„ê³ ë“±í•™êµ í•™ìƒë“¤ì„ ìœ„í•œ ì›¹ ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤."
    />

    <!-- Open Graph íƒœê·¸ (ì†Œì…œ ë¯¸ë””ì–´ ê³µìœ ìš©) -->
    <meta property="og:title" content="ì™„ëŒ€ì „" />
    <meta
      property="og:description"
      content="ì™„ë„ê³ ë“±í•™êµ í•™ìƒë“¤ì„ ìœ„í•œ ì›¹ ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤."
    />
    <meta property="og:image" content="https://wdj.kr/content.png" />
    <meta property="og:url" content="https://wdj.kr/" />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/asset/icon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/asset/icon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/asset/icon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/asset/icon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/asset/icon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/asset/icon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/asset/icon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/asset/icon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/asset/icon/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/asset/icon/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/asset/icon/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/asset/icon/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/asset/icon/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/asset/icon/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/asset/icon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="/asset/icon/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/asset/icon/favicon-16x16.png"
    />
    <link rel="manifest" href="/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png" />
    <meta name="theme-color" content="#ffffff" />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Pretendard", "sans-serif"],
            },
            colors: {
              primary: {
                50: "#E6F0FF",
                100: "#CCE0FF",
                200: "#99C2FF",
                300: "#66A3FF",
                400: "#3385FF",
                500: "#0066FF",
                600: "#0052CC",
                700: "#003D99",
                800: "#002966",
                900: "#001433",
              },
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      #mobile-menu {
        position: fixed;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100vh;
        background-color: #2563eb;
        transition: left 0.3s ease-in-out;
        z-index: 50;
      }

      #mobile-menu.active {
        left: 0;
      }

      .mobile-menu-content {
        padding: 2rem;
        height: 100%;
        overflow-y: auto;
      }

      .mobile-menu-link {
        display: block;
        padding: 1rem;
        color: white;
        font-size: 1.125rem;
        border-radius: 0.5rem;
        transition: all 0.2s;
      }

      .mobile-menu-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .nav-link {
        padding: 0.5rem 0;
        position: relative;
        display: inline-block;
      }

      .nav-link::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: white;
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.3s ease;
      }

      .nav-link:hover::after {
        transform: scaleX(1);
        transform-origin: left;
      }

      .nav-link.active::after {
        transform: scaleX(1);
      }

      .nav-link:hover {
        transform: translateY(-1px);
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <header
      class="bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg py-1 mb-8 fixed w-full top-0 z-50"
    >
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-3">
          <div class="flex justify-start lg:w-0 lg:flex-1">
            <a
              href="/index.html"
              class="text-2xl font-bold text-white hover:text-gray-100 transition-all duration-300 transform hover:scale-105"
            >
              ì™„Â·ëŒ€Â·ì „
            </a>
          </div>
          <nav class="hidden md:flex space-x-8">
            <a
              href="notice.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">ê³µì§€ì‚¬í•­</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="community.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">ì»¤ë®¤ë‹ˆí‹°</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="petition.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">ì²­ì›Â·ì œì•ˆ</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="utility.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">í•™ê¸‰ ë„ìš°ë¯¸</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="about.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">ì†Œê°œ</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
          </nav>
          <div class="md:hidden">
            <button
              id="mobile-menu-button"
              class="rounded-lg p-2 inline-flex items-center justify-center text-white hover:bg-blue-500/50 transition-all duration-300"
              aria-label="ë©”ë‰´ ì—´ê¸°"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div id="mobile-menu" class="md:hidden">
        <div class="mobile-menu-content">
          <div class="flex justify-between items-center mb-4">
            <a href="/index.html" class="text-xl font-bold text-white"
              >ì™„Â·ëŒ€Â·ì „</a
            >
            <button
              id="mobile-menu-close"
              class="p-1.5 rounded-lg text-white hover:bg-blue-500/50 transition-all duration-300"
              aria-label="ë©”ë‰´ ë‹«ê¸°"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
          <nav class="space-y-2">
            <a href="notice.html" class="mobile-menu-link text-sm">ê³µì§€ì‚¬í•­</a>
            <a href="community.html" class="mobile-menu-link text-sm"
              >ì»¤ë®¤ë‹ˆí‹°</a
            >
            <a href="petition.html" class="mobile-menu-link text-sm"
              >ì²­ì›Â·ì œì•ˆ</a
            >
            <a href="utility.html" class="mobile-menu-link text-sm"
              >í•™ê¸‰ ë„ìš°ë¯¸</a
            >
            <a href="about.html" class="mobile-menu-link text-sm">ì†Œê°œ</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="w-full sm:container mx-auto mt-24 mb-16 px-4 sm:px-8">
      <div class="mb-4 sm:mb-8">
        <div class="flex justify-between items-center mb-3 sm:mb-6">
          <h1 class="text-xl sm:text-3xl font-bold">ìµëª… ê²Œì‹œíŒ</h1>
        </div>
        <form id="searchForm" class="flex flex-col sm:flex-row gap-2 sm:gap-4">
          <div class="flex-1 relative">
            <input
              type="text"
              id="searchInput"
              placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
              class="w-full p-2 border rounded focus:outline-none focus:border-blue-500 text-sm sm:text-base pr-12"
            />
            <button
              type="submit"
              class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-blue-500 transition-colors"
            >
              <i class="fas fa-search text-lg"></i>
            </button>
          </div>
          <div class="sm:w-32">
            <select
              id="searchType"
              class="w-full p-2 border rounded focus:outline-none focus:border-blue-500 text-sm sm:text-base"
            >
              <option value="title">ì œëª©</option>
              <option value="author">ê¸€ì“´ì´</option>
            </select>
          </div>
        </form>
      </div>

      <!-- ì •ë ¬ ì˜µì…˜ ì„¤ì • ë° ê¸€ì“°ê¸° ë²„íŠ¼ ì„¹ì…˜ ìˆ˜ì • -->
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2 sm:gap-0"
      >
        <!-- ì™¼ìª½ ì˜µì…˜ë“¤ -->
        <div class="flex items-center justify-between w-full sm:w-auto">
          <div class="flex items-center space-x-2">
            <select
              id="sortOption"
              class="border rounded px-2 py-1 text-xs sm:text-sm focus:outline-none focus:border-blue-500"
              onchange="handleSort(this.value)"
            >
              <option value="latest">ìµœì‹ ìˆœ</option>
              <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
              <option value="best">ì¶”ì²œìˆœ</option>
              <option value="views">ì¡°íšŒìˆœ</option>
            </select>

            <select
              id="postsPerPage"
              class="border rounded px-2 py-1 text-xs sm:text-sm focus:outline-none focus:border-blue-500"
            >
              <option value="15">15ê°œ</option>
              <option value="30">30ê°œ</option>
              <option value="50">50ê°œ</option>
            </select>

            <!-- ì´ ê²Œì‹œê¸€ ìˆ˜ë¥¼ ê°™ì€ ì¤„ì— ë°°ì¹˜ -->
            <span class="text-xs sm:text-sm text-gray-600 ml-2">
              ì´ <span id="totalPosts" class="font-semibold">0</span>ê°œì˜ ê¸€
            </span>
          </div>
        </div>

        <!-- ê¸€ì“°ê¸° ë²„íŠ¼ì„ PCì—ì„œëŠ” ì˜¤ë¥¸ìª½, ëª¨ë°”ì¼ì—ì„œëŠ” ì•„ë˜ì— ë°°ì¹˜ -->
        <button
          id="writePostBtn"
          class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white px-4 py-1.5 rounded-lg font-semibold transition-colors text-xs sm:text-sm ml-auto"
        >
          ê¸€ì“°ê¸°
        </button>
      </div>

      <!-- ë² ìŠ¤íŠ¸ê¸€ê³¼ ì¼ë°˜ ê²Œì‹œê¸€ ì‚¬ì´ ê°„ê²© ì¤„ì´ê¸° -->
      <div id="bestPosts" class="mb-2 sm:mb-4">
        <h2
          class="text-lg sm:text-2xl font-bold mb-3 sm:mb-6 flex items-center px-2"
        >
          <span class="text-xl sm:text-3xl mr-2">ğŸ†</span> ì£¼ê°„ ë² ìŠ¤íŠ¸
        </h2>
        <div class="space-y-3 sm:space-y-6" id="bestPostsList">
          <!-- ë² ìŠ¤íŠ¸ ê²Œì‹œê¸€ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <!-- êµ¬ë¶„ì„  ê°„ê²© ì¤„ì´ê¸° -->
        <div class="relative mt-2 sm:mt-4 mb-2 sm:mb-4">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-300"></div>
          </div>
          <div class="relative flex justify-center">
            <span class="bg-gray-100 px-3 text-xs sm:text-sm text-gray-500"
              >ì¼ë°˜ ê²Œì‹œê¸€</span
            >
          </div>
        </div>
      </div>

      <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
      <div id="postList" class="space-y-2 sm:space-y-4">
        <!-- ê²Œì‹œê¸€ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div
        id="pagination"
        class="mt-10 flex justify-center space-x-3 sm:space-x-2"
      >
        <!-- í˜ì´ì§€ ë²„íŠ¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>
    </main>

    <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ ìˆ˜ì • -->
    <div
      id="writePostModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white p-6 rounded-lg w-full max-w-lg">
        <h2 class="text-2xl font-bold mb-4">ê¸€ì“°ê¸°</h2>
        <form id="writePostForm">
          <input
            type="text"
            id="postTitle"
            placeholder="ì œëª©"
            class="w-full p-2 mb-4 border rounded"
            required
          />
          <textarea
            id="postContent"
            placeholder="ë‚´ìš©"
            class="w-full p-2 mb-4 border rounded h-40"
            required
          ></textarea>
          <div class="mb-4">
            <input type="checkbox" id="isAnonymous" />
            <label for="isAnonymous">ìµëª…ìœ¼ë¡œ ì‘ì„±</label>
          </div>
          <div class="flex justify-end">
            <button
              type="button"
              id="cancelWritePost"
              class="bg-gray-300 text-black px-4 py-2 rounded mr-2"
            >
              ì·¨ì†Œ
            </button>
            <button
              type="submit"
              class="bg-blue-500 text-white px-4 py-2 rounded"
            >
              ì‘ì„±
            </button>
          </div>
        </form>
      </div>
    </div>

    <footer
      class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-2 md:py-4"
    >
      <div class="container mx-auto px-6 lg:px-8">
        <!-- ëª¨ë°”ì¼ìš© í‘¸í„° -->
        <div class="md:hidden space-y-3">
          <div class="flex justify-center space-x-4">
            <a
              href="pages/notice.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >ê³µì§€ì‚¬í•­</a
            >
            <a
              href="pages/community.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >ì»¤ë®¤ë‹ˆí‹°</a
            >
            <a
              href="pages/petition.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >ì²­ì›Â·ì œì•ˆ</a
            >
          </div>

          <div class="text-center text-sm text-gray-400">
            <a href="mailto:sungblab@gmail.com" class="hover:text-blue-400">
              sungblab@gmail.com
            </a>
          </div>
        </div>

        <!-- ë°ìŠ¤í¬í†±ìš© í‘¸í„° -->
        <div class="hidden md:grid grid-cols-3 gap-8">
          <!-- ê¸°ì¡´ ë°ìŠ¤í¬í†± í‘¸í„° ë‚´ìš© ìœ ì§€ -->
          <div class="space-y-3">
            <h3 class="text-xl font-bold text-white mb-2">ì™„Â·ëŒ€Â·ì „</h3>
            <p class="text-gray-400 text-sm leading-relaxed">
              ì™„ë„ê³ ë“±í•™êµ í•™ìƒë“¤ì„ ìœ„í•œ<br />
              ë” ë‚˜ì€ í•™êµìƒí™œì„ ë§Œë“¤ì–´ê°€ëŠ”<br />
              ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼
            </p>
          </div>

          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-white mb-2">ë°”ë¡œê°€ê¸°</h4>
            <ul class="space-y-1.5">
              <li>
                <a
                  href="pages/notice.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >ê³µì§€ì‚¬í•­</a
                >
              </li>
              <li>
                <a
                  href="pages/community.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >ì»¤ë®¤ë‹ˆí‹°</a
                >
              </li>
              <li>
                <a
                  href="pages/petition.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >ì²­ì›Â·ì œì•ˆ</a
                >
              </li>
              <li>
                <a
                  href="pages/utility.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >í•™ê¸‰ ë„ìš°ë¯¸</a
                >
              </li>
            </ul>
          </div>

          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-white mb-2">ë¬¸ì˜ ë° ì •ì±…</h4>
            <div class="space-y-1.5">
              <p class="flex items-center text-gray-400 text-sm">
                <i class="fas fa-envelope mr-2"></i>
                <a
                  href="mailto:sungblab@gmail.com"
                  class="hover:text-blue-400 transition-colors duration-300"
                  >sungblab@gmail.com</a
                >
              </p>
              <p class="flex items-center text-gray-400 text-sm">
                <i class="fas fa-map-marker-alt mr-2"></i>
                ì „ë‚¨ ì™„ë„êµ° ì™„ë„ì ê°œí¬ë¡œ 134
              </p>
              <a
                href="/pages/privacy-policy.html"
                class="block text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
              >
                <i class="fas fa-shield-alt mr-2"></i>
                ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨
              </a>
            </div>
          </div>
        </div>

        <!-- ê³µí†µ í•˜ë‹¨ ì˜ì—­ -->
        <div class="border-t border-gray-700 mt-8 pt-6">
          <div class="flex flex-col items-center space-y-3">
            <p class="text-xs text-gray-400 text-center">
              &copy; 2024 CodeLab. All rights reserved.
            </p>
            <div class="flex space-x-4">
              <a
                href="#"
                class="text-gray-400 hover:text-blue-400 transition-colors duration-300"
              >
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenuClose = document.getElementById("mobile-menu-close");
        const mobileMenu = document.getElementById("mobile-menu");

        mobileMenuButton.addEventListener("click", () => {
          mobileMenu.classList.toggle("active");
        });

        mobileMenuClose.addEventListener("click", () => {
          mobileMenu.classList.remove("active");
        });
      });

      // ì „ì—­ ë³€ìˆ˜ ë° ìƒìˆ˜ ì •ì˜
      const API_BASE_URL =
        "https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app";
      let postsPerPage = 15;
      let currentPage = 1;

      // API ìš”ì²­ í•¨ìˆ˜
      async function apiRequest(url, method = "GET", body = null) {
        const token = localStorage.getItem("token");
        const headers = {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        };
        const options = {
          method,
          headers,
          body: body ? JSON.stringify(body) : null,
        };
        const response = await fetch(`${API_BASE_URL}${url}`, options);
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || "API request failed");
        }
        return response.json();
      }

      // ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      async function fetchPosts() {
        try {
          const sortOption = document.getElementById("sortOption").value;
          const response = await fetch(
            `${API_BASE_URL}/api/posts?page=${currentPage}&limit=${postsPerPage}&sort=${sortOption}`
          );

          if (!response.ok) {
            throw new Error("Failed to fetch posts");
          }

          const data = await response.json();
          console.log("Fetched data:", data); // ë°ì´í„° í™•ì¸ìš© ë¡œê·¸
          displayPosts(data);
        } catch (error) {
          console.error("ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
          displayError("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // í‘œì‹œ ê°œìˆ˜ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document
        .getElementById("postsPerPage")
        .addEventListener("change", function (e) {
          postsPerPage = parseInt(e.target.value);
          currentPage = 1; // í˜ì´ì§€ ì´ˆê¸°í™”
          fetchPosts(currentPage);
        });

      // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ìˆ˜ì •
      function updatePagination(current, total) {
        const pagination = document.getElementById("pagination");
        let html = "";

        // ì²˜ìŒ í˜ì´ì§€ë¡œ ì´ë™
        html += `<button class="px-2 py-1 rounded ${
          current === 1 ? "text-gray-400" : "text-blue-500"
        }"
              ${current === 1 ? "disabled" : ""} onclick="fetchPosts(1)">
              <i class="fas fa-angle-double-left"></i>
            </button>`;

        // ì´ì „ í˜ì´ì§€
        html += `<button class="px-2 py-1 rounded ${
          current === 1 ? "text-gray-400" : "text-blue-500"
        }"
              ${current === 1 ? "disabled" : ""} onclick="fetchPosts(${
          current - 1
        })">
              <i class="fas fa-angle-left"></i>
            </button>`;

        // í˜ì´ì§€ ë²ˆí˜¸
        let startPage = Math.max(1, current - 2);
        let endPage = Math.min(total, current + 2);

        for (let i = startPage; i <= endPage; i++) {
          html += `<button class="px-3 py-1 rounded ${
            i === current ? "bg-blue-500 text-white" : "text-gray-700"
          }"
                onclick="fetchPosts(${i})">${i}</button>`;
        }

        // ë‹¤ìŒ í˜ì´ì§€
        html += `<button class="px-2 py-1 rounded ${
          current === total ? "text-gray-400" : "text-blue-500"
        }"
              ${current === total ? "disabled" : ""} onclick="fetchPosts(${
          current + 1
        })">
              <i class="fas fa-angle-right"></i>
            </button>`;

        // ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™
        html += `<button class="px-2 py-1 rounded ${
          current === total ? "text-gray-400" : "text-blue-500"
        }"
              ${
                current === total ? "disabled" : ""
              } onclick="fetchPosts(${total})">
              <i class="fas fa-angle-double-right"></i>
            </button>`;

        pagination.innerHTML = html;
      }

      // formatDate í•¨ìˆ˜ ìˆ˜ì •
      function formatDate(date) {
        try {
          if (!date) return "";

          const now = new Date();
          const targetDate = new Date(date);

          // ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œì¸ ê²½ìš°
          if (isNaN(targetDate.getTime())) {
            return "";
          }

          const timeDiff = now - targetDate;
          const seconds = Math.floor(timeDiff / 1000);
          const minutes = Math.floor(seconds / 60);
          const hours = Math.floor(minutes / 60);
          const days = Math.floor(hours / 24);

          if (seconds < 60) return "ë°©ê¸ˆ ì „";
          if (minutes < 60) return `${minutes}ë¶„ ì „`;
          if (hours < 24) return `${hours}ì‹œê°„ ì „`;
          if (days < 7) return `${days}ì¼ ì „`;

          return targetDate.toLocaleDateString("ko-KR", {
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          });
        } catch (error) {
          console.error("ë‚ ì§œ í¬í¬ë§· ì˜¤ë¥˜:", error);
          return "";
        }
      }

      // ê²Œì‹œê¸€ í‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
      function displayPosts(data) {
        // ë² ìŠ¤íŠ¸ê¸€ ì„¹ì…˜
        const bestPostsContainer = document.getElementById("bestPosts");
        const bestPostsList = document.getElementById("bestPostsList");

        if (data.bestPosts && data.bestPosts.length > 0) {
          bestPostsContainer.style.display = "block";
          bestPostsList.innerHTML = data.bestPosts
            .map(
              (post) => `
                <div class="bg-yellow-50 p-3 sm:p-4 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 cursor-pointer border-l-4 border-yellow-400" 
                     onclick="location.href='post-detail.html?id=${post._id}'">
                  <div class="flex justify-between items-start">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900">
                      ğŸ† ${post.title}
                      <span class="ml-2 text-xs sm:text-sm font-bold text-blue-500">+${
                        post.score || 0
                      }</span>
                    </h3>
                    <div class="flex items-center space-x-2 sm:space-x-4 text-xs sm:text-sm text-gray-500">
                      <span><i class="far fa-eye"></i> ${post.views || 0}</span>
                      <span><i class="far fa-comment"></i> ${
                        post.comments?.length || 0
                      }</span>
                      <div class="flex items-center space-x-1">
                        <span class="text-blue-500"><i class="fas fa-arrow-up"></i> ${
                          post.upvotes || 0
                        }</span>
                        <span class="text-red-500"><i class="fas fa-arrow-down"></i> ${
                          post.downvotes || 0
                        }</span>
                      </div>
                    </div>
                  </div>
                  <div class="mt-1 sm:mt-2 text-xs sm:text-sm text-gray-600">
                    <span class="font-medium">${
                      post.author?.nickname || "ìµëª…"
                    }</span>
                    ${
                      post.ipAddress
                        ? `<span class="text-gray-400">(${post.ipAddress})</span>`
                        : ""
                    }
                    <span class="mx-2">|</span>
                    <span>${formatDate(post.createdAt)}</span>
                  </div>
                </div>
              `
            )
            .join("");
        } else {
          bestPostsContainer.style.display = "none";
        }

        // ì¼ë°˜ ê²Œì‹œê¸€ ëª©ë¡
        const postList = document.getElementById("postList");

        // ì „ì²´ ê²Œì‹œê¸€ì´ ì—†ëŠ” ê²½ìš°ë§Œ ë©”ì‹œì§€ í‘œì‹œ
        if (
          !data.posts ||
          (data.posts.length === 0 &&
            (!data.bestPosts || data.bestPosts.length === 0))
        ) {
          postList.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
          `;
          return;
        }

        // ì¼ë°˜ ê²Œì‹œê¸€ ëª©ë¡ í‘œì‹œ
        if (data.posts && data.posts.length > 0) {
          postList.innerHTML = data.posts
            .map(
              (post) => `
              <div class="bg-white p-3 sm:p-4 rounded-lg shadow hover:shadow-md transition-all duration-200 cursor-pointer mb-2 sm:mb-4" 
                   onclick="location.href='post-detail.html?id=${post._id}'">
                <div class="flex justify-between items-start">
                  <h3 class="text-base sm:text-lg font-semibold text-gray-900">
                    ${post.title}
                    ${
                      post.score > 0
                        ? `<span class="ml-2 text-xs sm:text-sm font-bold ${
                            post.score >= 10 ? "text-red-500" : "text-blue-500"
                          }">
                        +${post.score}
                      </span>`
                        : ""
                    }
                  </h3>
                  <div class="flex items-center space-x-2 sm:space-x-4 text-xs sm:text-sm text-gray-500">
                    <span><i class="far fa-eye"></i> ${post.views || 0}</span>
                    <span><i class="far fa-comment"></i> ${
                      post.comments?.length || 0
                    }</span>
                    <div class="flex items-center space-x-1">
                      <span class="text-blue-500"><i class="fas fa-arrow-up"></i> ${
                        post.upvotes
                      }</span>
                      <span class="text-red-500"><i class="fas fa-arrow-down"></i> ${
                        post.downvotes
                      }</span>
                    </div>
                  </div>
                </div>
                <div class="mt-1 sm:mt-2 text-xs sm:text-sm text-gray-600">
                  <span class="font-medium">${
                    post.author?.nickname || "ìµëª…"
                  }</span>
                  ${
                    post.ipAddress
                      ? `<span class="text-gray-400">(${post.ipAddress})</span>`
                      : ""
                  }
                  <span class="mx-2">|</span>
                  <span>${formatDate(post.createdAt)}</span>
                </div>
              </div>
            `
            )
            .join("");
        } else {
          postList.innerHTML = `
            <div class="text-center py-8 text-gray-500">
              ì¼ë°˜ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
          `;
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
        updatePagination(data.currentPage, data.totalPages);

        // ì´ì‹œê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
        document.getElementById("totalPosts").textContent = data.totalPosts;
      }

      // ì •ë ¬ ì²˜ë¦¬ í•¨ìˆ˜
      async function handleSort(sortType) {
        try {
          const response = await fetch(
            `${API_BASE_URL}/api/posts?sort=${sortType}&page=${currentPage}&limit=${postsPerPage}`
          );

          if (!response.ok) {
            throw new Error("Failed to fetch sorted posts");
          }

          const data = await response.json();
          displayPosts(data);
          updatePagination(data.currentPage, data.totalPages);
        } catch (error) {
          console.error("ì •ë ¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:", error);
          displayError("ê²Œì‹œê¸€ ì •ë ¬ì„ ì²˜ë¦¬í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // searchPosts í•¨ìˆ˜ ìˆ˜ì •
      async function searchPosts(searchQuery, searchType) {
        try {
          // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´ ëª©ë¡ í‘œì‹œ
          if (!searchQuery.trim()) {
            return fetchPosts();
          }

          // í˜„ì¬ í‘œì‹œëœ ê²Œì‹œê¸€ë“¤ ê°€ì ¸ì˜¤ê¸°
          const postList = document.getElementById("postList");
          const bestPostsContainer = document.getElementById("bestPosts");

          // ê²Œì‹œê¸€ í•„í•„í„°ë§ í•¨ìˆ˜
          function filterPost(post, query, type) {
            query = query.toLowerCase();
            switch (type) {
              case "title":
                return post.title.toLowerCase().includes(query);
              case "content":
                return post.content.toLowerCase().includes(query);
              case "author":
                const authorName =
                  post.author?.nickname || post.anonymousNick || "ìµëª…";
                return authorName.toLowerCase().includes(query);
              default: // all (ì œëª©+ë‚´ìš©)
                return (
                  post.title.toLowerCase().includes(query) ||
                  post.content.toLowerCase().includes(query)
                );
            }
          }

          // ì „ì²´ ê²Œì‹œê¸€ ê°€ì ¸ì˜¤ê¸°
          const response = await fetch(
            `${API_BASE_URL}/api/posts?page=1&limit=100`
          );

          if (!response.ok) {
            throw new Error("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }

          const data = await response.json();

          // ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì‹œê¸€ í•„í„°ë§
          const filteredBestPosts = data.bestPosts.filter((post) =>
            filterPost(post, searchQuery, searchType)
          );

          const filteredPosts = data.posts.filter((post) =>
            filterPost(post, searchQuery, searchType)
          );

          // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
          displayPosts({
            bestPosts: filteredBestPosts,
            posts: filteredPosts,
            currentPage: 1,
            totalPages: 1,
            totalPosts: filteredPosts.length,
          });

          // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
          const totalPosts = document.getElementById("totalPosts");
          totalPosts.textContent = `ê²€ìƒ‰ê²°ê³¼: ${filteredPosts.length}ê°œ`;
        } catch (error) {
          console.error("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜:", error);
          displayError("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      }

      // ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì •
      document
        .getElementById("searchForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const searchQuery = document.getElementById("searchInput").value;
          const searchType = document.getElementById("searchType").value;
          await searchPosts(searchQuery, searchType);
        });

      // ì—ëŸ¬ í‘œí‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
      function displayError(message) {
        const postList = document.getElementById("postList");
        postList.innerHTML = `
              <div class="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded">
                <p class="text-center">${message}</p>
              </div>
            `;
      }

      // ì´ì „ê¸€/ë‹¤ìŒê¸€ ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
      function updateNavigation(firstPostId, lastPostId) {
        const prevBtn = document.getElementById("prevPost");
        const nextBtn = document.getElementById("nextPost");

        prevBtn.disabled = !firstPostId;
        nextBtn.disabled = !lastPostId;

        if (firstPostId) {
          prevBtn.onclick = () => fetchPosts({ before: firstPostId });
        }
        if (lastPostId) {
          nextBtn.onclick = () => fetchPosts({ after: lastPostId });
        }
      }

      // ê¸€ ì‘ì„± í•¨ìˆ˜
      async function submitPost(e) {
        e.preventDefault();
        const title = document.getElementById("postTitle").value;
        const content = document.getElementById("postContent").value;
        const isAnonymous = document.getElementById("isAnonymous").checked;

        try {
          const response = await apiRequest("/api/posts", "POST", {
            title,
            content,
            board: "all",
            isAnonymous,
          });

          document.getElementById("writePostModal").classList.add("hidden");
          alert("ê²Œì‹œê¸€ì´ ì„±ì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
          fetchPosts(); // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } catch (error) {
          console.error("ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          alert("ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      }

      // ëŒ“ê¸€ ì‘ì„± í•¨ìˆ˜
      async function submitComment(postId, content, isAnonymous) {
        try {
          await apiRequest(`/api/posts/${postId}/comments`, "POST", {
            content,
            isAnonymous,
          });
          // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ë¡œì§ ì¶”ê°€
        } catch (error) {
          console.error("ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        }
      }

      // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      async function checkLoginStatus() {
        const token = localStorage.getItem("token");
        if (token) {
          try {
            const response = await apiRequest("/api/user");
            localStorage.setItem("user", JSON.stringify(response));
            if (response.isAdmin) {
              console.log("ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë¨");
              // ì—¬ê¸°ì— ê´€ë¦¬ì UI í‘œì‹œ ë¡œì§ ì¶”ê°€
            }
          } catch (error) {
            console.error("ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
            localStorage.removeItem("token");
            localStorage.removeItem("user");
          }
        }
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      document.addEventListener("DOMContentLoaded", function () {
        // ê¸°ì¡´ì˜ searchForm ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
        const oldSearchFormListener = document
          .getElementById("searchForm")
          .querySelector("submit");
        if (oldSearchFormListener) {
          document
            .getElementById("searchForm")
            .removeEventListener("submit", oldSearchFormListener);
        }

        // ë‚˜ë¨¸ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤...
      });

      // í˜ì´ì§€ ë¡œë“œë“œ ì‹œ ì‹¤í–‰
      window.onload = function () {
        checkLoginStatus();
        fetchPosts();
      };

      // ê¸€ì“°ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
      document
        .getElementById("writePostBtn")
        .addEventListener("click", function () {
          // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
          const token = localStorage.getItem("token");

          if (!token) {
            // ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” write-post.htmlë¡œ ì§ì ‘ ì´ë™
            window.location.href = "write-post.html";
          } else {
            // ë¡œê·¸ì¸ ì‚¬ìš©ìë„ write-post.htmlë¡œ ì´ë™
            window.location.href = "write-post.html";
          }
        });
    </script>
  </body>
</html>
