<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>완대전</title>
    <meta
      name="description"
      content="완도고등학교 학생들을 위한 웹 커뮤니티 사이트입니다."
    />

    <!-- Open Graph 태그 (소셜 미디어 공유용) -->
    <meta property="og:title" content="완대전" />
    <meta
      property="og:description"
      content="완도고등학교 학생들을 위한 웹 커뮤니티 사이트입니다."
    />
    <meta property="og:image" content="https://wdj.kr/content.png" />
    <meta property="og:url" content="https://wdj.kr/" />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/asset/icon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/asset/icon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/asset/icon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/asset/icon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="57x57"
      href="/asset/icon/apple-icon-57x57.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="60x60"
      href="/asset/icon/apple-icon-60x60.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="/asset/icon/apple-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="/asset/icon/apple-icon-76x76.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/asset/icon/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/asset/icon/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/asset/icon/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/asset/icon/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/asset/icon/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/asset/icon/android-icon-192x192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/asset/icon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="/asset/icon/favicon-96x96.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/asset/icon/favicon-16x16.png"
    />
    <link rel="manifest" href="/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png" />
    <meta name="theme-color" content="#ffffff" />
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Pretendard", "sans-serif"],
            },
            colors: {
              primary: {
                50: "#E6F0FF",
                100: "#CCE0FF",
                200: "#99C2FF",
                300: "#66A3FF",
                400: "#3385FF",
                500: "#0066FF",
                600: "#0052CC",
                700: "#003D99",
                800: "#002966",
                900: "#001433",
              },
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      #mobile-menu {
        position: fixed;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100vh;
        background-color: #2563eb;
        transition: left 0.3s ease-in-out;
        z-index: 50;
      }

      #mobile-menu.active {
        left: 0;
      }

      .mobile-menu-content {
        padding: 2rem;
        height: 100%;
        overflow-y: auto;
      }

      .mobile-menu-link {
        display: block;
        padding: 1rem;
        color: white;
        font-size: 1.125rem;
        border-radius: 0.5rem;
        transition: all 0.2s;
      }

      .mobile-menu-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .nav-link {
        padding: 0.5rem 0;
        position: relative;
        display: inline-block;
      }

      .nav-link::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: white;
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.3s ease;
      }

      .nav-link:hover::after {
        transform: scaleX(1);
        transform-origin: left;
      }

      .nav-link.active::after {
        transform: scaleX(1);
      }

      .nav-link:hover {
        transform: translateY(-1px);
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <header
      class="bg-gradient-to-r from-blue-600 to-blue-700 shadow-lg py-2 mb-8 fixed w-full top-0 z-50"
    >
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-3">
          <div class="flex justify-start lg:w-0 lg:flex-1">
            <a
              href="/index.html"
              class="text-3xl font-bold text-white hover:text-gray-100 transition-all duration-300 transform hover:scale-105"
            >
              완·대·전
            </a>
          </div>
          <nav class="hidden md:flex space-x-8">
            <a
              href="notice.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">공지사항</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="community.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">커뮤니티</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="petition.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">청원·제안</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="utility.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">학급 도우미</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
            <a
              href="about.html"
              class="nav-link group relative text-base font-medium text-white transition-all duration-300"
            >
              <span class="relative z-10">소개</span>
              <span
                class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"
              ></span>
            </a>
          </nav>
          <div class="md:hidden">
            <button
              id="mobile-menu-button"
              class="rounded-lg p-2 inline-flex items-center justify-center text-white hover:bg-blue-500/50 transition-all duration-300"
              aria-label="메뉴 열기"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div id="mobile-menu" class="md:hidden">
        <div class="mobile-menu-content">
          <div class="flex justify-between items-center mb-8">
            <a href="/index.html" class="text-2xl font-bold text-white"
              >완·대·전</a
            >
            <button
              id="mobile-menu-close"
              class="p-2 rounded-lg text-white hover:bg-blue-500/50 transition-all duration-300"
              aria-label="메뉴 닫기"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
          <nav class="space-y-4">
            <a href="notice.html" class="mobile-menu-link">공지사항</a>
            <a href="community.html" class="mobile-menu-link">커뮤니티</a>
            <a href="petition.html" class="mobile-menu-link">청원·제안</a>
            <a href="utility.html" class="mobile-menu-link">학급 도우미</a>
            <a href="about.html" class="mobile-menu-link">소개</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="w-full sm:container mx-auto mt-24 mb-16 px-4 sm:px-8">
      <h1 class="text-3xl font-bold mb-8 text-blue-700 flex items-center">
        <i class="fas fa-bullhorn mr-2"></i>
        공지사항
      </h1>

      <div id="adminControls" class="mb-6 hidden">
        <button
          onclick="showNoticeForm()"
          class="bg-blue-600 text-white px-6 py-2 rounded-lg transition-all duration-300 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
        >
          <i class="fas fa-plus mr-2"></i>새 공지사항 작성
        </button>
      </div>

      <div id="noticeForm" class="mb-6 hidden">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800">
              <i class="fas fa-pen-fancy mr-2 text-blue-600"></i>
              공지사항 작성
            </h2>
            <button
              onclick="cancelNoticeForm()"
              class="text-gray-400 hover:text-gray-600 transition-colors"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <form id="noticeSubmitForm" class="space-y-6">
            <input type="hidden" id="noticeId" />

            <div>
              <label
                for="noticeTitle"
                class="block text-sm font-medium text-gray-700 mb-2"
                >제목</label
              >
              <input
                type="text"
                id="noticeTitle"
                name="title"
                required
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 focus:border-transparent transition duration-200"
                placeholder="공지사항 제목을 입력하세요"
              />
            </div>

            <div>
              <label
                for="noticeContent"
                class="block text-sm font-medium text-gray-700 mb-2"
                >내용</label
              >
              <textarea
                id="noticeContent"
                name="content"
                required
                rows="8"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 focus:border-transparent transition duration-200"
                placeholder="공지사항 내용을 입력하세요"
              ></textarea>
            </div>

            <div class="flex items-center space-x-2">
              <input
                type="checkbox"
                id="noticeImportant"
                name="important"
                class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-600"
              />
              <label for="noticeImportant" class="text-sm text-gray-700"
                >중요 공지사항으로 등록</label
              >
            </div>

            <div class="flex justify-end space-x-3 pt-6">
              <button
                type="button"
                onclick="cancelNoticeForm()"
                class="px-6 py-2.5 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition duration-200"
              >
                취소
              </button>
              <button
                type="submit"
                class="px-6 py-2.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition duration-200"
              >
                저장하기
              </button>
            </div>
          </form>
        </div>
      </div>

      <div id="noticeList" class="space-y-6">
        <!-- 공지사항이 여기에 동적으로 추가됩니다 -->
      </div>

      <div id="pagination" class="mt-8 flex justify-center space-x-2">
        <!-- 페이지네이션 버튼이 여기에 동적으로 추가됩니다 -->
      </div>
    </main>

    <footer
      class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-10"
    >
      <div class="container mx-auto px-6 lg:px-8">
        <!-- 모바일용 푸터 -->
        <div class="md:hidden space-y-6">
          <div class="text-center">
            <h3 class="text-xl font-bold text-white mb-2">완·대·전</h3>
            <p class="text-gray-400 text-sm">
              완도고등학교 학생들을 위한<br />
              온라인 커뮤니티 플랫폼
            </p>
          </div>

          <div class="flex justify-center space-x-4">
            <a
              href="pages/notice.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >공지사항</a
            >
            <a
              href="pages/community.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >커뮤니티</a
            >
            <a
              href="pages/petition.html"
              class="text-gray-400 hover:text-blue-400 text-sm"
              >청원·제안</a
            >
          </div>

          <div class="text-center text-sm text-gray-400">
            <a href="mailto:sungblab@gmail.com" class="hover:text-blue-400">
              sungblab@gmail.com
            </a>
          </div>
        </div>

        <!-- 데스크톱용 푸터 -->
        <div class="hidden md:grid grid-cols-3 gap-8">
          <!-- 기존 데스크톱 푸터 내용 유지 -->
          <div class="space-y-3">
            <h3 class="text-xl font-bold text-white mb-2">완·대·전</h3>
            <p class="text-gray-400 text-sm leading-relaxed">
              완도고등학교 학생들을 위한<br />
              더 나은 학교생활을 만들어가는<br />
              온라인 커뮤니티 플랫폼
            </p>
          </div>

          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-white mb-2">바로가기</h4>
            <ul class="space-y-1.5">
              <li>
                <a
                  href="pages/notice.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >공지사항</a
                >
              </li>
              <li>
                <a
                  href="pages/community.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >커뮤니티</a
                >
              </li>
              <li>
                <a
                  href="pages/petition.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >청원·제안</a
                >
              </li>
              <li>
                <a
                  href="pages/utility.html"
                  class="text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
                  >학급 도우미</a
                >
              </li>
            </ul>
          </div>

          <div class="space-y-3">
            <h4 class="text-lg font-semibold text-white mb-2">문의 및 정책</h4>
            <div class="space-y-1.5">
              <p class="flex items-center text-gray-400 text-sm">
                <i class="fas fa-envelope mr-2"></i>
                <a
                  href="mailto:sungblab@gmail.com"
                  class="hover:text-blue-400 transition-colors duration-300"
                  >sungblab@gmail.com</a
                >
              </p>
              <p class="flex items-center text-gray-400 text-sm">
                <i class="fas fa-map-marker-alt mr-2"></i>
                전남 완도군 완도읍 개포로 134
              </p>
              <a
                href="/pages/privacy-policy.html"
                class="block text-gray-400 hover:text-blue-400 transition-colors duration-300 text-sm"
              >
                <i class="fas fa-shield-alt mr-2"></i>
                개인정보 처리방침
              </a>
            </div>
          </div>
        </div>

        <!-- 공통 하단 영역 -->
        <div class="border-t border-gray-700 mt-8 pt-6">
          <div class="flex flex-col items-center space-y-3">
            <p class="text-xs text-gray-400 text-center">
              &copy; 2024 완도고등학교 학생회. All rights reserved.
            </p>
            <div class="flex space-x-4">
              <a
                href="#"
                class="text-gray-400 hover:text-blue-400 transition-colors duration-300"
              >
              </a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      let currentPage = 1;
      const limit = 10;
      let isAdmin = false;

      async function checkLoginStatus() {
        const token = localStorage.getItem("token");
        if (token) {
          try {
            const response = await fetch(
              "https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/user",
              {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              }
            );
            if (response.ok) {
              const userData = await response.json();
              isAdmin = userData.isAdmin;
              document
                .getElementById("adminControls")
                .classList.toggle("hidden", !isAdmin);
            }
          } catch (error) {
            console.error("로그인 상태 확인 실패:", error);
          }
        }
      }

      async function fetchNotices(page) {
        try {
          const token = localStorage.getItem("token");
          const response = await fetch(
            `https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/notices?page=${page}&limit=${limit}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("서버 응답 오류");
          }

          const data = await response.json();
          displayNotices(data.notices);
          displayPagination(data.totalPages, data.currentPage);
        } catch (error) {
          console.error("공지사항을 불러오는 데 실패했습니다:", error);
          document.getElementById("noticeList").innerHTML = `
            <div class="text-center py-8">
              <p class="text-gray-500">공지사항을 불러오는 데 실패했습니다.</p>
              <button onclick="fetchNotices(1)" class="mt-4 text-blue-600 hover:text-blue-700">
                <i class="fas fa-redo mr-1"></i> 다시 시도
              </button>
            </div>
          `;
        }
      }

      function displayNotices(notices) {
        const noticeList = document.getElementById("noticeList");
        noticeList.innerHTML = "";

        // 중요 공지사항과 일반 공지사항 분리
        const importantNotices = notices.filter((notice) => notice.important);
        const normalNotices = notices.filter((notice) => !notice.important);

        // 중요 공지사항 섹션
        if (importantNotices.length > 0) {
          noticeList.innerHTML += `
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-gray-700 mb-4">
                <i class="fas fa-star text-yellow-500 mr-2"></i>중요 공지사항
              </h3>
              <div class="space-y-4">
                ${importantNotices
                  .map((notice) => createNoticeCard(notice))
                  .join("")}
              </div>
            </div>
          `;
        }

        // 일반 공지사항 섹션
        noticeList.innerHTML += `
          <div>
            <h3 class="text-lg font-semibold text-gray-700 mb-4">
              <i class="fas fa-list text-blue-600 mr-2"></i>공지사항
            </h3>
            <div class="space-y-4">
              ${normalNotices
                .map((notice) => createNoticeCard(notice))
                .join("")}
            </div>
          </div>
        `;
      }

      function createNoticeCard(notice) {
        return `
          <div onclick="viewNotice('${notice._id}')" 
            class="bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer
            ${notice.important ? "border-l-4 border-l-yellow-500" : ""}">
            <div class="p-5 md:p-6">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3">
                <div class="flex flex-wrap items-center gap-2">
                  <span class="text-sm text-gray-500">
                    ${new Date(notice.createdAt).toLocaleDateString()}
                  </span>
                  ${
                    notice.important
                      ? '<span class="px-2 py-1 text-xs font-medium text-yellow-800 bg-yellow-100 rounded-full">중요</span>'
                      : ""
                  }
                </div>
              </div>
              
              <h4 class="text-lg font-medium text-gray-900 hover:text-blue-600 transition-colors duration-200 mb-2">
                ${notice.title}
              </h4>
              <p class="text-sm text-gray-600 line-clamp-2">${
                notice.content
              }</p>
            </div>
          </div>
        `;
      }

      function displayPagination(totalPages, currentPage) {
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const button = document.createElement("button");
          button.innerText = i;
          button.className = `px-4 py-2 rounded transition-colors duration-300 ${
            i === currentPage
              ? "bg-blue-600 text-white"
              : "bg-white text-gray-700 hover:bg-gray-100"
          }`;
          button.onclick = () => fetchNotices(i);
          pagination.appendChild(button);
        }
      }

      async function viewNotice(id) {
        try {
          const token = localStorage.getItem("token");
          const response = await fetch(
            `https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/notices/${id}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("서버 응답 오류");
          }

          const notice = await response.json();
          displayNoticeDetail(notice);

          // URL 히스토리 관리
          window.history.pushState({ noticeId: id }, "", `?notice=${id}`);
        } catch (error) {
          console.error("공지사항 조회 실패:", error);
          alert("공지사항을 불러오는데 실패했습니다.");
        }
      }

      function displayNoticeDetail(notice) {
        const noticeList = document.getElementById("noticeList");
        const pagination = document.getElementById("pagination");
        pagination.classList.add("hidden");

        noticeList.innerHTML = `
          <div class="bg-white rounded-lg shadow-md">
            <div class="p-5 md:p-8">
              <!-- 상단 헤더 -->
              <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <button onclick="fetchNotices(currentPage)" 
                  class="flex items-center text-gray-600 hover:text-blue-600 transition-colors">
                  <i class="fas fa-arrow-left text-xl mr-2"></i>
                  <span>목록으로</span>
                </button>
                ${
                  isAdmin
                    ? `
                  <div class="flex gap-3">
                    <button onclick="editNotice('${notice._id}')" 
                      class="flex-1 sm:flex-none flex items-center justify-center px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors">
                      <i class="fas fa-edit mr-2"></i>수정
                    </button>
                    <button onclick="deleteNotice('${notice._id}')" 
                      class="flex-1 sm:flex-none flex items-center justify-center px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors">
                      <i class="fas fa-trash-alt mr-2"></i>삭제
                    </button>
                  </div>
                `
                    : ""
                }
              </div>

              <!-- 공지사항 정보 -->
              <div class="flex flex-wrap gap-4 text-sm text-gray-500 mb-6">
                <span class="flex items-center">
                  <i class="fas fa-calendar-alt mr-2"></i>
                  ${new Date(notice.createdAt).toLocaleDateString()}
                </span>
                <span class="flex items-center">
                  <i class="fas fa-user-shield mr-2"></i>
                  관리자
                </span>
                ${
                  notice.important
                    ? '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">' +
                      '<i class="fas fa-star mr-1"></i>중요</span>'
                    : ""
                }
              </div>

              <!-- 제목 -->
              <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-8">
                ${notice.title}
              </h1>

              <!-- 내용 -->
              <div class="prose max-w-none text-gray-600 leading-relaxed">
                ${notice.content
                  .split("\n")
                  .map((line) =>
                    line ? `<p class="mb-4">${line}</p>` : "<br>"
                  )
                  .join("")}
              </div>
            </div>
          </div>
        `;
      }

      function showNoticeForm(noticeId = null) {
        document.getElementById("noticeForm").classList.remove("hidden");
        document.getElementById("noticeList").classList.add("hidden");
        document.getElementById("pagination").classList.add("hidden");

        if (noticeId) {
          // 수정 모드
          document.getElementById("noticeId").value = noticeId;
          // 여기에 공지사항 데이터를 가져와서 폼에 채우는 로직 추가
        } else {
          // 새 공지사항 작성 모드
          document.getElementById("noticeSubmitForm").reset();
          document.getElementById("noticeId").value = "";
        }
      }

      function cancelNoticeForm() {
        document.getElementById("noticeForm").classList.add("hidden");
        document.getElementById("noticeList").classList.remove("hidden");
        document.getElementById("pagination").classList.remove("hidden");
      }

      async function submitNoticeForm(event) {
        event.preventDefault();
        const token = localStorage.getItem("token");
        const form = event.target;
        const noticeId = document.getElementById("noticeId").value;
        const formData = new FormData(form);
        const noticeData = {
          title: formData.get("title"),
          content: formData.get("content"),
          important: formData.get("important") === "on",
        };

        try {
          const url = noticeId
            ? `https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/notices/${noticeId}`
            : "https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/notices";

          const response = await fetch(url, {
            method: noticeId ? "PUT" : "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(noticeData),
          });

          if (!response.ok) {
            throw new Error("서버 응답 오류");
          }

          const result = await response.json();
          console.log("공지사항 저장 성공:", result);

          cancelNoticeForm();
          fetchNotices(currentPage);
        } catch (error) {
          console.error("공지사항 저장 실패:", error);
          alert("공지사항 저장에 실패했습니다. 다시 시도해주세요.");
        }
      }

      async function editNotice(id) {
        try {
          const token = localStorage.getItem("token");
          const response = await fetch(
            `https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/notices/${id}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("서버 응답 오류");
          }

          const notice = await response.json();

          // 폼 표시 및 데이터 채우기
          showNoticeForm(id);
          document.getElementById("noticeTitle").value = notice.title;
          document.getElementById("noticeContent").value = notice.content;
          document.getElementById("noticeImportant").checked = notice.important;

          // 폼 제목 변경
          document.querySelector("#noticeForm h2").innerHTML = `
            <i class="fas fa-pen-fancy mr-2 text-blue-600"></i>
            공지사항 수정
          `;
        } catch (error) {
          console.error("공지사항 수정 정보 로드 실패:", error);
          alert("공지사항 정보를 불러오는데 실패했습니다.");
        }
      }

      async function deleteNotice(id) {
        if (!confirm("정말로 이 공지사항을 삭제하시겠습니까?")) {
          return;
        }

        try {
          const token = localStorage.getItem("token");
          const response = await fetch(
            `https://port-0-wdj-back-lz9cd9taff85e9dc.sel4.cloudtype.app/api/notices/${id}`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            throw new Error("서버 응답 오류");
          }

          await fetchNotices(currentPage);
        } catch (error) {
          console.error("공지사항 삭제 실패:", error);
          alert("공지사항 삭제에 실패했습니다. 다시 시도해주세요.");
        }
      }

      // 페이지 로드 시 URL 파라미터 체크
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const noticeId = urlParams.get("notice");

        checkLoginStatus();
        if (noticeId) {
          viewNotice(noticeId);
        } else {
          fetchNotices(currentPage);
        }

        document
          .getElementById("noticeSubmitForm")
          .addEventListener("submit", submitNoticeForm);
      });

      document.addEventListener("DOMContentLoaded", function () {
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenuClose = document.getElementById("mobile-menu-close");
        const mobileMenu = document.getElementById("mobile-menu");

        mobileMenuButton.addEventListener("click", () => {
          mobileMenu.classList.toggle("active");
        });

        mobileMenuClose.addEventListener("click", () => {
          mobileMenu.classList.remove("active");
        });
      });

      // 브라우저 뒤로가기 처리
      window.addEventListener("popstate", (event) => {
        if (event.state?.noticeId) {
          viewNotice(event.state.noticeId);
        } else {
          fetchNotices(currentPage);
        }
      });
    </script>
  </body>
</html>
