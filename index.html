<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>완대전</title>
    <link
      href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Spoqa Han Sans Neo", "sans-serif"],
            },
            colors: {
              primary: {
                50: "#E6F0FF",
                100: "#CCE0FF",
                200: "#99C2FF",
                300: "#66A3FF",
                400: "#3385FF",
                500: "#0066FF",
                600: "#0052CC",
                700: "#003D99",
                800: "#002966",
                900: "#001433",
              },
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      #mobile-menu {
        transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
        max-height: 0;
        opacity: 0;
        overflow: hidden;
      }
      #mobile-menu.active {
        max-height: 400px;
        opacity: 1;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <header class="bg-blue-600 shadow-md">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div
          class="flex justify-between items-center py-4 md:justify-start md:space-x-10"
        >
          <div class="flex justify-start lg:w-0 lg:flex-1">
            <a
              href="index.html"
              class="text-3xl font-bold text-white hover:text-gray-200 transition duration-300"
            >
              완·대·전
            </a>
          </div>
          <div class="-mr-2 -my-2 md:hidden">
            <button
              id="mobile-menu-button"
              type="button"
              class="bg-blue-500 rounded-md p-2 inline-flex items-center justify-center text-white hover:text-gray-200 hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
              aria-expanded="false"
            >
              <span class="sr-only">메뉴 열기</span>
              <svg
                class="h-6 w-6"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                />
              </svg>
            </button>
          </div>
          <nav class="hidden md:flex space-x-10">
            <a
              href="pages/notice.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >공지사항</a
            >
            <a
              href="pages/community.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >커뮤니티</a
            >
            <a
              href="pages/petition.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >청원·제안</a
            >
            <a
              href="pages/utility.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >학급 도우미</a
            >
            <a
              href="pages/about.html"
              class="text-base font-medium text-white hover:text-gray-200 transition duration-300"
              >소개</a
            >
          </nav>
        </div>
      </div>

      <div
        id="mobile-menu"
        class="absolute top-0 inset-x-0 p-2 transition transform origin-top-right md:hidden"
      >
        <div
          class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 bg-blue-500 divide-y-2 divide-blue-400"
        >
          <div class="pt-5 pb-6 px-5">
            <div class="flex items-center justify-between">
              <div>
                <a href="index.html" class="text-2xl font-bold text-white"
                  >완·대·전</a
                >
              </div>
              <div class="-mr-2">
                <button
                  id="mobile-menu-close"
                  type="button"
                  class="bg-blue-500 rounded-md p-2 inline-flex items-center justify-center text-white hover:text-gray-200 hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
                >
                  <span class="sr-only">메뉴 닫기</span>
                  <svg
                    class="h-6 w-6"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    aria-hidden="true"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"
                    />
                  </svg>
                </button>
              </div>
            </div>
            <div class="mt-6">
              <nav class="grid gap-y-8">
                <a
                  href="pages/notice.html"
                  class="-m-3 p-3 flex items-center rounded-md hover:bg-blue-400 transition duration-300"
                >
                  <span class="ml-3 text-base font-medium text-white"
                    >공지사항</span
                  >
                </a>
                <a
                  href="pages/community.html"
                  class="-m-3 p-3 flex items-center rounded-md hover:bg-blue-400 transition duration-300"
                >
                  <span class="ml-3 text-base font-medium text-white"
                    >커뮤니티</span
                  >
                </a>
                <a
                  href="pages/petition.html"
                  class="-m-3 p-3 flex items-center rounded-md hover:bg-blue-400 transition duration-300"
                >
                  <span class="ml-3 text-base font-medium text-white"
                    >청원·제안</span
                  >
                </a>
                <a
                  href="pages/utility.html"
                  class="-m-3 p-3 flex items-center rounded-md hover:bg-blue-400 transition duration-300"
                >
                  <span class="ml-3 text-base font-medium text-white"
                    >학급 도우미</span
                  >
                </a>
                <a
                  href="pages/about.html"
                  class="-m-3 p-3 flex items-center rounded-md hover:bg-blue-400 transition duration-300"
                >
                  <span class="ml-3 text-base font-medium text-white"
                    >소개</span
                  >
                </a>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </header>
    <main class="container mx-auto mt-8 px-8 mb-16">
      <div class="grid md:grid-cols-3 gap-8 mb-8">
        <!-- 공지사항 섹션 -->
        <section class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-2xl font-bold mb-4 text-blue-700">공지사항</h3>
          <ul id="noticeList" class="space-y-2">
            <!-- 공지사항이 여기에 동적으로 추가됩니다 -->
          </ul>
          <a
            href="pages/notice.html"
            class="text-blue-500 hover:underline mt-4 inline-block"
            >더 보기</a
          >
        </section>

        <!-- 오늘의 급식 섹션 -->
        <section class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold mb-6 text-blue-700">오늘의 급식</h2>
          <div id="mealCarousel" class="relative">
            <div class="overflow-hidden">
              <div
                id="mealSlider"
                class="flex transition-transform duration-300 ease-in-out"
              >
                <div id="breakfast" class="meal-slide w-full flex-shrink-0">
                  <h3 class="text-lg font-semibold mb-2">조식</h3>
                  <ul class="space-y-2 text-gray-700"></ul>
                  <p class="mt-2 text-sm text-gray-600"></p>
                </div>
                <div id="lunch" class="meal-slide w-full flex-shrink-0">
                  <h3 class="text-lg font-semibold mb-2">중식</h3>
                  <ul class="space-y-2 text-gray-700"></ul>
                  <p class="mt-2 text-sm text-gray-600"></p>
                </div>
                <div id="dinner" class="meal-slide w-full flex-shrink-0">
                  <h3 class="text-lg font-semibold mb-2">석식</h3>
                  <ul class="space-y-2 text-gray-700"></ul>
                  <p class="mt-2 text-sm text-gray-600"></p>
                </div>
              </div>
            </div>
            <button
              id="prevMeal"
              aria-label="이전 급식"
              class="absolute left-4 top-1 transform text-blue-500 top-1 hover:text-blue-700 transition duration-300"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                />
              </svg>
            </button>
            <button
              id="nextMeal"
              aria-label="다음 급식"
              class="absolute right-4 top-1 transform top-1 transform text-blue-500 top-1 hover:text-blue-700 transition duration-300"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
            </button>
          </div>
        </section>

        <section id="authSection" class="bg-white rounded-lg shadow-md p-6">
          <div id="loginSection">
            <h3 class="text-2xl font-bold mb-4 text-blue-700">로그인</h3>
            <form id="loginForm" class="mb-4">
              <div class="mb-4">
                <input
                  type="text"
                  id="loginUsername"
                  name="username"
                  placeholder="아이디"
                  class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <div class="mb-4">
                <input
                  type="password"
                  id="loginPassword"
                  name="password"
                  placeholder="비밀번호"
                  class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <button
                type="submit"
                class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition duration-300"
              >
                로그인
              </button>
            </form>
            <p class="text-gray-600 text-center">계정이 없으신가요?</p>
            <div class="text-center mt-2">
              <a
                href="pages/signup.html"
                class="text-blue-500 hover:text-blue-700"
                >회원가입</a
              >
            </div>
            <div class="text-center mt-2">
              <a
                href="pages/find-password.html"
                class="text-blue-500 hover:text-blue-700"
                >비밀번호 찾기</a
              >
            </div>
            <p id="loginMessage" class="text-center text-red-500"></p>
          </div>

          <div id="userInfoSection" class="hidden">
            <h3 class="text-2xl font-bold mb-4 text-blue-700">사용자 정보</h3>
            <div class="space-y-2">
              <p>
                <span class="text-gray-600 w-24 inline-block">이름:</span
                ><span id="userName" class="font-semibold"></span>
              </p>
              <p>
                <span class="text-gray-600 w-24 inline-block">학번:</span
                ><span id="userUsername" class="font-semibold"></span>
              </p>
              <p>
                <span class="text-gray-600 w-24 inline-block">닉네임:</span
                ><span id="userNickname" class="font-semibold"></span>
              </p>
            </div>

            <button
              id="logoutButton"
              class="w-full bg-red-500 text-white p-2 rounded hover:bg-red-600 transition duration-300 mt-4"
            >
              로그아웃
            </button>
            <div class="text-center mt-4">
              <a
                href="pages/find-password.html"
                class="text-blue-500 hover:text-blue-700"
                >비밀번호 변경</a
              >
            </div>
          </div>
        </section>
      </div>

      <!-- 환영합니다 섹션 -->
      <section
        class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl shadow-lg p-8 mb-12 text-white"
      >
        <h2 class="text-4xl font-bold mb-4">환영합니다!</h2>
        <p class="text-xl">
          완도고등학교 학생들을 위한 커뮤니티, 완대전입니다. 여러분의 학교
          생활을 더욱 풍요롭게 만들어 드리겠습니다.
        </p>
      </section>

      <div class="grid md:grid-cols-3 gap-8">
        <!-- 학사일정 섹션 -->
        <section class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-2xl font-bold mb-4 text-blue-700">학사일정</h3>
          <div class="flex justify-between items-center mb-4">
            <button
              id="prevMonth"
              class="text-blue-500 hover:text-blue-700 transition duration-300"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                />
              </svg>
            </button>
            <span
              id="currentMonth"
              class="text-lg font-semibold text-gray-800"
            ></span>
            <button
              id="nextMonth"
              class="text-blue-500 hover:text-blue-700 transition duration-300"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
            </button>
          </div>
          <div class="h-64 overflow-y-auto pr-2">
            <ul id="scheduleList" class="space-y-3">
              <!-- 학사일정 항목들이 여기에 동적으로 추가됩니다 -->
            </ul>
          </div>
        </section>

        <!-- 커뮤니티 섹션 -->
        <section class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-2xl font-bold mb-4 text-blue-700">커뮤니티</h3>
          <ul class="space-y-2">
            <li>
              <a href="#" class="text-gray-700 hover:text-blue-500"
                >학교 앞 새로 생긴 카페 어떤가요?</a
              >
            </li>
            <li>
              <a href="#" class="text-gray-700 hover:text-blue-500"
                >이번 체육대회 종목 투표해주세요!</a
              >
            </li>
            <li>
              <a href="#" class="text-gray-700 hover:text-blue-500"
                >전교생 소풍 장소 추천 받습니다.</a
              >
            </li>
          </ul>
        </section>

        <!-- 청원·제안 섹션 -->
        <section class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-2xl font-bold mb-4 text-blue-700">청원·제안</h3>
          <ul id="petitionList" class="space-y-2">
            <!-- 청원 목록이 여기에 동적으로 추가됩니다 -->
          </ul>
          <a
            href="pages/petition.html"
            class="text-blue-500 hover:underline mt-4 inline-block"
            >더 보기</a
          >
        </section>
      </div>
    </main>

    <footer class="bg-gray-800 text-white py-12">
      <div class="container mx-auto px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <h4 class="text-2xl font-bold mb-4">완대전</h4>
            <p class="text-gray-300 mb-4">
              완도고등학교 학생들을 위한 유용한 웹사이트
            </p>
            <div class="flex space-x-4">
              <a
                href="https://www.instagram.com/wdj_hs/ "
                target="_blank"
                class="text-gray-300 hover:text-white transition duration-300"
              >
                <i class="fab fa-instagram"></i>
              </a>
              <p class="text-gray-300">IG: wdj_hs</p>
            </div>
          </div>
          <div>
            <h4 class="text-xl font-semibold mb-4">빠른 링크</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="pages/notice.html"
                  class="text-gray-300 hover:text-white transition duration-300"
                >
                  공지사항
                </a>
              </li>
              <li>
                <a
                  href="pages/community.html"
                  class="text-gray-300 hover:text-white transition duration-300"
                >
                  커뮤니티
                </a>
              </li>
              <li>
                <a
                  href="pages/petition.html"
                  class="text-gray-300 hover:text-white transition duration-300"
                >
                  청원·제안
                </a>
              </li>
              <li>
                <a
                  href="pages/utility.html"
                  class="text-gray-300 hover:text-white transition duration-300"
                >
                  학급 도우미
                </a>
              </li>
            </ul>
          </div>
          <div>
            <h4 class="text-xl font-semibold mb-4">연락처</h4>
            <p class="text-gray-300 mb-2">이메일: ksb19558@naver.com</p>
            <p class="text-gray-300 mb-4">연락 인스타그램 : wdj_hs</p>
            <a
              href="pages/privacy-policy.html"
              class="text-blue-400 hover:text-blue-300 transition duration-300"
            >
              개인정보 처리방침
            </a>
          </div>
        </div>
        <div
          class="border-t border-gray-700 mt-8 pt-8 text-sm text-center text-gray-400"
        >
          <p>&copy; 2024 완대전. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const API_KEY = "91f8dc8c8135439b8361d3540e05ec70";
        const SCHOOL_CODE = "8490065";
        const OFFICE_CODE = "Q10";
        const SPECIFIC_DATE = "20230512"; // 2023년 5월 12일

        let currentDate = new Date();

        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenuClose = document.getElementById("mobile-menu-close");
        const mobileMenu = document.getElementById("mobile-menu");
        const loginForm = document.getElementById("loginForm");
        const loginMessage = document.getElementById("loginMessage");
        const logoutButton = document.getElementById("logoutButton");
        const loginSection = document.getElementById("loginSection");
        const userInfoSection = document.getElementById("userInfoSection");
        const prevMonthBtn = document.getElementById("prevMonth");
        const nextMonthBtn = document.getElementById("nextMonth");
        const currentMonthSpan = document.getElementById("currentMonth");
        const scheduleList = document.getElementById("scheduleList");

        mobileMenuButton.addEventListener("click", () => {
          mobileMenu.classList.toggle("active");
        });

        mobileMenuClose.addEventListener("click", () => {
          mobileMenu.classList.remove("active");
        });

        function updateUI(isLoggedIn, userData) {
          if (isLoggedIn && userData) {
            loginSection.classList.add("hidden");
            userInfoSection.classList.remove("hidden");
            document.getElementById("userName").textContent =
              userData.realName || "이름 없음";
            document.getElementById("userUsername").textContent =
              userData.username || "학번 없음";
            document.getElementById("userNickname").textContent =
              userData.nickname || "닉네임 없음";
          } else {
            loginSection.classList.remove("hidden");
            userInfoSection.classList.add("hidden");
          }
        }

        async function checkLoginStatus() {
          const token = localStorage.getItem("token");
          if (token) {
            try {
              const response = await fetch("http://localhost:8080/api/user", {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              });
              if (!response.ok) {
                throw new Error("Login session expired");
              }
              const userData = await response.json();
              updateUI(true, userData);
            } catch (error) {
              console.error("Error:", error);
              localStorage.removeItem("token");
              updateUI(false);
            }
          } else {
            updateUI(false);
          }
        }

        loginForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const username = document.getElementById("loginUsername").value;
          const password = document.getElementById("loginPassword").value;
          try {
            const response = await fetch("http://localhost:8080/api/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, password }),
            });
            const data = await response.json();
            if (response.ok) {
              localStorage.setItem("token", data.token);
              loginMessage.textContent =
                "로그인 성공! 페이지를 새로고침합니다...";
              loginMessage.style.color = "green";
              setTimeout(() => {
                window.location.reload();
              }, 1000);
            } else {
              loginMessage.textContent = data.message || "로그인 실패";
              loginMessage.style.color = "red";
            }
          } catch (error) {
            console.error("Error:", error);
            loginMessage.textContent = "로그인 중 오류가 발생했습니다.";
            loginMessage.style.color = "red";
          }
        });

        logoutButton.addEventListener("click", function () {
          localStorage.removeItem("token");
          window.location.reload();
        });

        async function fetchNotices() {
          try {
            const response = await fetch(
              "http://localhost:8080/api/notices?limit=3"
            );
            if (!response.ok) {
              throw new Error("서버 응답 오류");
            }
            const data = await response.json();
            const noticeList = document.getElementById("noticeList");
            noticeList.innerHTML = "";
            data.notices.forEach((notice) => {
              const li = document.createElement("li");
              li.className = "flex items-center";
              li.innerHTML = `
          <span class="text-blue-500 mr-2"><i class="fas fa-info-circle"></i></span>
          <a href="pages/notice.html" class="text-gray-700 hover:text-blue-500 transition duration-300">${notice.title}</a>
        `;
              noticeList.appendChild(li);
            });
          } catch (error) {
            console.error("공지사항을 불러오는 데 실패했습니다:", error);
            const noticeList = document.getElementById("noticeList");
            noticeList.innerHTML =
              '<li class="text-red-500">공지사항을 불러오는 데 실패했습니다.</li>';
          }
        }

        async function getMealInfo() {
          try {
            const response = await axios.get(
              "https://open.neis.go.kr/hub/mealServiceDietInfo",
              {
                params: {
                  KEY: API_KEY,
                  Type: "json",
                  ATPT_OFCDC_SC_CODE: OFFICE_CODE,
                  SD_SCHUL_CODE: SCHOOL_CODE,
                  MLSV_YMD: SPECIFIC_DATE,
                },
              }
            );

            if (response.data.RESULT) {
              throw new Error(response.data.RESULT.MESSAGE);
            }

            if (!response.data.mealServiceDietInfo) {
              throw new Error("급식 정보가 없습니다.");
            }

            const meals = response.data.mealServiceDietInfo[1].row;
            updateMealInfo(meals);
          } catch (error) {
            console.error("급식 정보를 가져오는 데 실패했습니다:", error);
            document.getElementById("mealCarousel").innerHTML =
              "<p class='text-red-500 text-center'>급식 정보를 불러오는 데 실패했습니다. 잠시 후 다시 시도해 주세요.</p>";
          }
        }

        function updateMealInfo(meals) {
          const mealTypes = ["조식", "중식", "석식"];
          const mealIds = ["breakfast", "lunch", "dinner"];

          // 날짜 표시 업데이트
          const dateDisplay = document.createElement("p");
          dateDisplay.textContent = `2023년 5월 12일 급식 정보`;
          dateDisplay.className =
            "text-lg font-semibold text-center mb-4 text-blue-600";
          document.getElementById("mealCarousel").prepend(dateDisplay);

          mealTypes.forEach((type, index) => {
            const meal = meals.find((m) => m.MMEAL_SC_NM === type);
            const mealElement = document.getElementById(mealIds[index]);
            const list = mealElement.querySelector("ul");
            const calInfo = mealElement.querySelector("p");

            if (meal) {
              const dishes = meal.DDISH_NM.split("<br/>");
              list.innerHTML = dishes
                .map((dish) => `<li>${dish.trim()}</li>`)
                .join("");
              calInfo.textContent = `칼로리: ${meal.CAL_INFO}`;
            } else {
              list.innerHTML = "<li>급식 정보가 없습니다.</li>";
              calInfo.textContent = "";
            }
          });
        }

        let currentSlide = 0;
        const slider = document.getElementById("mealSlider");
        const slides = document.querySelectorAll(".meal-slide");
        const totalSlides = slides.length;

        function updateSlider() {
          slider.style.transform = `translateX(-${currentSlide * 100}%)`;
        }

        document.getElementById("nextMeal").addEventListener("click", () => {
          currentSlide = (currentSlide + 1) % totalSlides;
          updateSlider();
        });

        document.getElementById("prevMeal").addEventListener("click", () => {
          currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
          updateSlider();
        });

        function formatDate(dateString) {
          const year = dateString.slice(0, 4);
          const month = dateString.slice(4, 6);
          const day = dateString.slice(6, 8);
          return `${month}월 ${day}일`;
        }

        async function getSchoolSchedule(year, month) {
          const fromDate = `${year}${String(month).padStart(2, "0")}01`;
          const toDate = `${year}${String(month).padStart(2, "0")}${new Date(
            year,
            month,
            0
          ).getDate()}`;

          try {
            const response = await axios.get(
              "https://open.neis.go.kr/hub/SchoolSchedule",
              {
                params: {
                  KEY: API_KEY,
                  Type: "json",
                  ATPT_OFCDC_SC_CODE: OFFICE_CODE,
                  SD_SCHUL_CODE: SCHOOL_CODE,
                  AA_FROM_YMD: fromDate,
                  AA_TO_YMD: toDate,
                },
              }
            );

            if (response.data.RESULT) {
              throw new Error(response.data.RESULT.MESSAGE);
            }

            if (!response.data.SchoolSchedule) {
              throw new Error("학사일정 정보가 없습니다.");
            }

            return response.data.SchoolSchedule[1].row;
          } catch (error) {
            console.error("학사일정을 가져오는 데 실패했습니다:", error);
            return [];
          }
        }

        function updateScheduleUI(schedules) {
          scheduleList.innerHTML = "";
          if (schedules.length === 0) {
            scheduleList.innerHTML =
              "<li class='text-gray-500 text-center'>이번 달 학사일정이 없습니다.</li>";
          } else {
            schedules.forEach((schedule) => {
              const li = document.createElement("li");
              li.className = "bg-gray-100 rounded-lg p-3 shadow-sm";
              li.innerHTML = `
          <span class="text-blue-600 font-semibold">${formatDate(
            schedule.AA_YMD
          )}</span>
          <p class="text-gray-800 mt-1">${schedule.EVENT_NM}</p>
        `;
              scheduleList.appendChild(li);
            });
          }
        }

        async function fetchPetitions() {
          try {
            const token = localStorage.getItem("token");
            const response = await fetch(
              "http://localhost:8080/api/petitions?status=active&limit=3",
              {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              }
            );
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            return data.petitions;
          } catch (error) {
            console.error("청원 목록을 가져오는 중 오류 발생:", error);
            return [];
          }
        }

        function displayPetitions(petitions) {
          const petitionList = document.getElementById("petitionList");
          petitionList.innerHTML = "";

          if (petitions.length === 0) {
            petitionList.innerHTML =
              '<li class="text-gray-500">현재 진행 중인 청원이 없습니다.</li>';
            return;
          }

          petitions.forEach((petition) => {
            const li = document.createElement("li");
            li.className = "flex items-center justify-between";
            li.innerHTML = `
      <a href="pages/petition.html#${petition._id}" class="text-gray-700 hover:text-blue-500 transition duration-300">${petition.title}</a>
      <span class="text-sm text-gray-500">동의 ${petition.supporters.length}</span>
    `;
            petitionList.appendChild(li);
          });
        }

        async function updatePetitionSection() {
          const petitions = await fetchPetitions();
          displayPetitions(petitions);
        }

        async function updateMonthSchedule() {
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth() + 1;
          currentMonthSpan.textContent = `${year}년 ${month}월`;

          const schedules = await getSchoolSchedule(year, month);
          updateScheduleUI(schedules);
        }

        prevMonthBtn.addEventListener("click", () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          updateMonthSchedule();
        });

        nextMonthBtn.addEventListener("click", () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          updateMonthSchedule();
        });

        // 페이지 로드 시 실행할 함수들
        checkLoginStatus();
        fetchNotices();
        getMealInfo();
        updateMonthSchedule();
        updatePetitionSection();
      });
    </script>
  </body>
</html>
